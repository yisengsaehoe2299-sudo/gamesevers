<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Game Server Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
body{background:#0b0b0f;color:#fff;overflow-x:hidden;}
header{padding:20px;text-align:center;font-size:28px;font-weight:bold;position:relative;z-index:2;}
.container{max-width:1100px;margin:auto;padding:20px;position:relative;z-index:2;min-height:80vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;}

/* แก้ไขส่วน Grid: เพิ่ม Gap และการจัดเรียงให้ขยับเมื่อมีของใหม่ */
.grid{
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px; /* เพิ่มระยะห่างระหว่างเซิร์ฟเวอร์ */
  width: 100%;
  padding: 10px;
}

.card{
  background:#14141c;
  border-radius:16px;
  padding:16px;
  text-align:center;
  width: 220px; /* ปรับขนาดให้กว้างขึ้นเล็กน้อย */
  transition: transform .2s, box-shadow .2s;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 1px solid #222;
}
.card:hover{transform: scale(1.05);box-shadow: 0 10px 20px rgba(0,0,0,0.5);}
.card img{width:100%;height:150px;object-fit:cover;border-radius:12px;margin-bottom:12px;background:#2a2a38;}

button{width:100%;padding:12px;border:none;border-radius:10px;background:#4f7cff;color:#fff;cursor:pointer;transition: background .2s;}
button:hover{background:#0353e9}
.back{margin-bottom:15px;background:#444; width: auto; padding: 10px 30px;}
.delete-btn{background:#e63946;margin-top:8px;}
.delete-btn:hover{background:#a4161a;}

.add-btn{position:fixed;top:20px;right:20px;width:50px;height:50px;border-radius:50%;background:#ff4f8b;color:#fff;border:none;cursor:pointer;z-index:3;display:flex;align-items:center;justify-content:center;font-size:32px;line-height:1;}
input,select,textarea{width:100%;padding:12px;margin-bottom:10px;border-radius:8px;border:none;background: #2a2a38; color: #fff;}
.hidden{display:none !important;}

.mode-box{background:#1b1b26;padding:15px;border-radius:10px;margin-bottom:15px; width: 100%; border: 1px solid #333;}
#addModeList label{display:grid;grid-template-columns:25px 1fr;gap:8px;margin:8px 0; text-align: left; cursor: pointer;}

.preview{width:100%;height:200px;border-radius:12px;background:#2a2a38;display:flex;align-items:center;justify-content:center;margin-bottom:15px;overflow:hidden; border: 1px dashed #555;}
.preview img{width:100%;height:100%;object-fit:cover;}

.page{width: 100%;}
.filter-box{margin: 15px 0; padding:15px; background:#1b1b26; border-radius:10px; display:none; gap:15px; flex-wrap:wrap; justify-content:center; border: 1px solid #333;}
.filter-box label { font-size: 14px; color: #ccc; }
.filter-box select { width: 140px; margin-bottom: 0; padding: 5px; background: #0b0b0f; border: 1px solid #4f7cff; }
</style>
</head>
<body>

<button class="add-btn" onclick="openAdd()">＋</button>
<header>หาเซิร์ฟเกม</header>

<div class="container">

<div id="page1" class="page">
  <h2 style="text-align:center; margin-bottom:20px;">เลือกเกม</h2>
  <div class="grid">
    <div class="card"><img src="Minecraft_F.png" alt="Minecraft"><button onclick="chooseGame('Minecraft')">Minecraft</button></div>
    <div class="card"><img src="Roblox_F.png" alt="Roblox"><button onclick="chooseGame('Roblox')">Roblox</button></div>
  </div>
</div>

<div id="page2" class="page hidden">
  <div style="text-align:center;"><button class="back" onclick="goPage(1)">← ย้อนกลับ</button></div>
  <h2 id="gameTitle" style="text-align:center; margin-bottom:20px;"></h2>
  <div class="grid" id="modeList"></div>
</div>

<div id="page3" class="page hidden">
  <div style="text-align:center;"><button class="back" onclick="goPage(2)">← ย้อนกลับ</button></div>
  <h2 id="serverTitle" style="text-align:center; margin-bottom:10px;"></h2>
  
  <div id="filterContainer" class="filter-box">
    <label>เวอร์ชัน:<br>
      <select id="filterVersion" onchange="renderServers()">
        <option value="">ทั้งหมด</option>
        <option value="original">แท้</option>
        <option value="both">แท้/เถื่อน</option>
      </select>
    </label>
    <label>Edition:<br>
      <select id="filterEdition" onchange="renderServers()">
        <option value="">ทั้งหมด</option>
        <option value="java">Java</option>
        <option value="bedrock">Bedrock</option>
        <option value="both">ทั้งสอง</option>
      </select>
    </label>
  </div>

  <div class="grid" id="serverList"></div>
</div>

<div id="page4" class="page hidden">
  <div style="text-align:center;"><button class="back" onclick="goPage(3)">← ย้อนกลับ</button></div>
  <h2 id="detailName" style="text-align:center; margin-bottom:15px;"></h2>
  <div class="preview" id="detailImg"></div>
  <div id="detailExtra" style="margin: 15px 0; background: #1b1b26; padding: 20px; border-radius: 12px; border: 1px solid #333;"></div>
  <p id="detailDesc" style="margin-bottom:25px; color: #ccc; text-align: center; line-height: 1.6;"></p>
  <div style="text-align:center;"><button class="delete-btn" id="deleteBtn" style="width: auto; padding: 12px 50px;">ลบเซิฟนี้ออกจากระบบ</button></div>
</div>

<div id="addPage" class="page hidden">
  <div style="text-align:center;"><button class="back" onclick="goPage(1)">← ย้อนกลับ</button></div>
  <h2 style="text-align:center; margin-bottom:20px;">ลงประกาศเซิร์ฟเวอร์</h2>
  <div style="max-width: 500px; width: 100%; margin: auto;">
      <select id="addGame" onchange="updateAddModes();toggleAdd()">
        <option value="">-- เลือกเกม --</option>
        <option>Minecraft</option>
        <option>Roblox</option>
      </select>
      <input id="addName" placeholder="ชื่อเซิร์ฟเวอร์">
      <textarea id="addDesc" rows="4" placeholder="รายละเอียดเซิร์ฟเวอร์ / กฎ / ช่องทางติดต่อ"></textarea>

      <div class="mode-box"><b>แนวเกม (เลือกได้อย่างน้อย 1 อย่าง)</b><div id="addModeList"></div></div>

      <div id="mcExtra" class="hidden">
        <b style="color: #4f7cff;">ตั้งค่าเฉพาะ Minecraft</b>
        <div style="display: flex; gap: 10px;">
            <select id="mcVersion"><option value="original">แท้</option><option value="both">แท้/เถื่อน</option></select>
            <select id="mcEdition"><option value="java">Java</option><option value="bedrock">Bedrock</option><option value="both">ทั้งคู่</option></select>
        </div>
        <input id="mcRealVersion" placeholder="เวอร์ชัน (เช่น 1.20.1)">
        <input id="pcIP" placeholder="IP เครื่อง PC (ถ้ามี)">
        <input id="phoneIP" placeholder="IP เครื่อง มือถือ (ถ้ามี)">
      </div>

      <div id="rbxFields" class="hidden">
        <b style="color: #00c2ff;">ลิงก์เข้าเกม Roblox</b>
        <input id="rbxLink" placeholder="https://www.roblox.com/games/...">
      </div>

      <b style="display: block; margin-top: 10px;">รูปภาพปกเซิร์ฟเวอร์</b>
      <div class="preview" id="imgPreview" style="height: 150px;">คลิกปุ่มด้านล่างเพื่อเลือกรูป</div>
      <input type="file" accept="image/*" id="addImg">
      
      <button onclick="saveServer()" style="margin: 30px 0; background: #27ae60; font-size: 18px; font-weight: bold;">ยืนยันการลงประกาศ</button>
  </div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBcs3Owrnp3doAgLpT84ieIZZ-RL8XA8zs",
  authDomain: "gamesevers-5421f.firebaseapp.com",
  databaseURL: "https://gamesevers-5421f-default-rtdb.firebaseio.com",
  projectId: "gamesevers-5421f"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const gameTitle=document.getElementById("gameTitle"), serverTitle=document.getElementById("serverTitle"),
      modeList=document.getElementById("modeList"), serverList=document.getElementById("serverList"),
      detailName=document.getElementById("detailName"), detailDesc=document.getElementById("detailDesc"),
      detailExtra=document.getElementById("detailExtra"), detailImg=document.getElementById("detailImg"),
      addGame=document.getElementById("addGame"), addName=document.getElementById("addName"),
      addDesc=document.getElementById("addDesc"), addModeList=document.getElementById("addModeList"),
      rbxFields=document.getElementById("rbxFields"), pcIP=document.getElementById("pcIP"),
      phoneIP=document.getElementById("phoneIP"), rbxLink=document.getElementById("rbxLink"),
      addImg=document.getElementById("addImg"), imgPreview=document.getElementById("imgPreview"),
      mcExtra=document.getElementById("mcExtra"), mcVersion=document.getElementById("mcVersion"),
      mcEdition=document.getElementById("mcEdition"), mcRealVersion=document.getElementById("mcRealVersion"),
      deleteBtn=document.getElementById("deleteBtn"), filterContainer=document.getElementById("filterContainer"),
      filterVersion=document.getElementById("filterVersion"), filterEdition=document.getElementById("filterEdition");

let servers=[];
let currentGame="", currentMode="", currentServerId="";

const modesByGame={
  Minecraft:["Survival","RPG","PVP","Skyblock","Minigame"],
  Roblox:["Adventure","RPG","Simulator","Obby","PVP","Tower Defense"]
};

window.show=(p)=>{
    document.querySelectorAll('.page').forEach(d=>d.classList.add('hidden'));
    document.getElementById(p).classList.remove('hidden');
    window.scrollTo(0,0);
};
window.goPage=n=>show("page"+n);
window.openAdd=()=>show("addPage");

window.chooseGame=g=>{
  currentGame=g;
  gameTitle.innerText=g;
  modeList.innerHTML="";
  modesByGame[g].forEach(m=>{
    modeList.innerHTML+=`<div class="card"><button onclick="chooseMode('${m}')">${m}</button></div>`;
  });
  show("page2");
};

window.chooseMode=m=>{
  currentMode=m;
  serverTitle.innerText=currentGame + " : " + m;
  if(currentGame === "Minecraft") {
    filterContainer.style.display = "flex";
  } else {
    filterContainer.style.display = "none";
  }
  renderServers();
  show("page3");
};

window.renderServers = () => {
  serverList.innerHTML="";
  // กรองข้อมูลตามเกมและแนวเกม
  let filtered = servers.filter(s=>s.game===currentGame && Array.isArray(s.modes) && s.modes.includes(currentMode));
  
  if(currentGame==="Minecraft"){
    if(filterVersion.value) filtered = filtered.filter(s=>s.version===filterVersion.value);
    if(filterEdition.value) filtered = filtered.filter(s=>s.edition===filterEdition.value);
  }

  if(filtered.length === 0) {
    serverList.innerHTML = "<p style='color:#666; margin-top:40px;'>ไม่มีเซิร์ฟเวอร์ในแนวเกมนี้</p>";
    return;
  }

  // สร้าง Card ทีละอัน และตรวจสอบว่าแต่ละอันมีระยะห่างกัน
  filtered.forEach(s=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
        <img src="${s.img}">
        <div style="margin-bottom:15px;">
            <p style="font-weight:bold; font-size:18px; color:#fff;">${s.name}</p>
            <small style="color:#888;">${s.game}</small>
        </div>
        <button onclick="openDetail('${s.id}')">ดูรายละเอียด</button>
    `;
    serverList.appendChild(card);
  });
};

window.openDetail=id=>{
  const s=servers.find(x=>x.id===id);
  if(!s) return;
  currentServerId=id;
  detailName.innerText=s.name;
  detailDesc.innerText=s.desc;
  detailImg.innerHTML=`<img src="${s.img}">`;
  
  if(s.game==="Minecraft") {
    detailExtra.innerHTML = `
      <p style="margin-bottom:8px;"><b>Version:</b> ${s.realVersion||"-"}</p>
      <p style="margin-bottom:8px;"><b>ระบบ:</b> ${s.version==="original"?"ของแท้เท่านั้น":"เข้าได้ทั้งแท้และเถื่อน"}</p>
      <p style="margin-bottom:8px;"><b>Edition:</b> ${s.edition.toUpperCase()}</p>
      <hr style="margin:15px 0; border:0; border-top:1px solid #444;">
      <p style="margin-bottom:5px;"><b>IP คอมพิวเตอร์:</b></p>
      <p style="color:#4f7cff; background:#0b0b0f; padding:8px; border-radius:5px; font-family:monospace; margin-bottom:10px;">${s.pc||"-"}</p>
      <p style="margin-bottom:5px;"><b>IP มือถือ/Bedrock:</b></p>
      <p style="color:#4f7cff; background:#0b0b0f; padding:8px; border-radius:5px; font-family:monospace;">${s.phone||"-"}</p>
    `;
  } else {
    detailExtra.innerHTML = `
        <p style="text-align:center; margin-bottom:15px; color:#aaa;">คลิกปุ่มด้านล่างเพื่อเปิดหน้าเกมใน Roblox</p>
        <div style="text-align:center;"><a href="${s.link}" target="_blank"><button style="background:#00c2ff; width:auto; padding:12px 60px; font-size:16px;">ไปยังหน้าเกม Roblox</button></a></div>
    `;
  }
  show("page4");
};

deleteBtn.onclick = () => {
  if(confirm("คุณต้องการลบเซิร์ฟเวอร์นี้ออกจากระบบใช่หรือไม่?")){
    remove(ref(db,"servers/"+currentServerId)).then(()=>{
      alert("ลบข้อมูลสำเร็จ");
      show("page1");
    });
  }
};

window.toggleAdd=()=>{
  mcExtra.classList.toggle("hidden", addGame.value!=="Minecraft");
  rbxFields.classList.toggle("hidden", addGame.value!=="Roblox");
};

window.updateAddModes=()=>{
  addModeList.innerHTML="";
  if(!addGame.value) return;
  modesByGame[addGame.value].forEach(m=>{
    addModeList.innerHTML+=`<label><input type="checkbox" value="${m}"> ${m}</label>`;
  });
};

addImg.onchange=()=>{
  const f=addImg.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=e=>{
    imgPreview.innerHTML=`<img src="${e.target.result}">`; 
    imgPreview.dataset.img=e.target.result;
  };
  r.readAsDataURL(f);
};

window.saveServer=()=>{
  const modes=[...addModeList.querySelectorAll("input:checked")].map(c=>c.value);
  if(!addGame.value||!addName.value||!modes.length||!imgPreview.dataset.img) return alert("กรุณากรอกข้อมูลและเลือกรูปภาพให้ครบถ้วน");

  const serverData = {
    game:addGame.value, name:addName.value, desc:addDesc.value, modes:modes, img:imgPreview.dataset.img,
    pc:pcIP.value||null, phone:phoneIP.value||null, link:rbxLink.value||null,
    version:addGame.value==="Minecraft"?mcVersion.value:null,
    edition:addGame.value==="Minecraft"?mcEdition.value:null,
    realVersion:addGame.value==="Minecraft"?mcRealVersion.value:null
  };

  push(ref(db,"servers"), serverData).then(()=>{
    alert("ลงประกาศเซิร์ฟเวอร์เรียบร้อยแล้ว!");
    location.reload();
  });
};

onValue(ref(db,"servers"), snap=>{
  servers=[];
  snap.forEach(c=>servers.push({id:c.key,...c.val()}));
  if(!document.getElementById("page3").classList.contains("hidden")) renderServers();
});
</script>
</body>
</html>
