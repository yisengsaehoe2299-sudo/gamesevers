<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Game Server Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* Reset & Base Styles */
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
body{background:#0b0b0f;color:#fff;min-height:100vh;display:flex;flex-direction:column;}

header{padding:30px 20px;text-align:center;font-size:32px;font-weight:bold;background: linear-gradient(to bottom, #14141c, #0b0b0f); border-bottom: 1px solid #2a2a38;}

.container{
  max-width:1200px;
  width: 100%;
  margin:0 auto;
  padding:20px;
  flex-grow: 1;
}

/* แก้ไขระบบ Grid ให้เรียงต่อกัน ไม่ทับกัน */
.grid{
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* ปรับขนาดขั้นต่ำให้กว้างขึ้นเล็กน้อย */
  gap: 20px;
  width: 100%;
  padding: 20px 0;
}

/* Card ดีไซน์ใหม่ แก้ไขปัญหาความสูง */
.card{
  background:#14141c;
  border-radius:20px;
  padding:20px;
  text-align:center;
  transition: all 0.3s ease;
  border: 1px solid #2a2a38;
  display: flex;
  flex-direction: column; /* จัดองค์ประกอบในแนวตั้ง */
  height: 100%; /* ให้ Card ทุกใบสูงเท่ากันในแถวเดียวกัน */
}
.card:hover{
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.5);
  border-color: #4f7cff;
}

.card img{
  width:100%;
  height:180px;
  object-fit:cover;
  border-radius:12px;
  margin-bottom:15px;
  background:#000;
  flex-shrink: 0; /* ป้องกันรูปโดนบีบ */
}

.card h3 {
  margin-bottom: 15px;
  font-size: 1.1rem;
  word-break: break-word; /* ป้องกันชื่อยาวเกินจนล้นการ์ด */
}

/* ดันปุ่มไปไว้ล่างสุดของการ์ดเสมอ */
.card-btn {
  margin-top: auto; 
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#4f7cff;
  color:#fff;
  cursor:pointer;
  font-weight: 600;
  transition: 0.2s;
}
.card-btn:hover{background:#0353e9;}

/* อื่นๆ */
button.back{
  margin-bottom:20px;
  background:#2a2a38;
  color: white;
  border: none;
  padding: 10px 25px;
  border-radius: 8px;
  cursor: pointer;
}

.delete-btn{background:#e63946; margin-top:15px; padding: 12px; border:none; color:white; border-radius:10px; cursor:pointer; width:100%;}
.add-btn{
  position:fixed; bottom:30px; right:30px; width:60px; height:60px;
  border-radius:50%; background:#ff4f8b; color:#fff; border:none;
  cursor:pointer; z-index:100; font-size:30px; box-shadow: 0 5px 15px rgba(255, 79, 139, 0.4);
}

input,select,textarea{ width:100%; padding:12px; margin-bottom:15px; border-radius:10px; border:1px solid #333; background: #1b1b26; color: #fff; }
.hidden{display:none !important;}

.filter-box{
  margin-bottom: 20px; padding:20px; background:#14141c; border-radius:15px;
  display:none; gap:15px; flex-wrap: wrap; justify-content:center; border: 1px solid #2a2a38;
}
.filter-box label{ font-size: 14px; color: #888; }
.filter-box select{ width: auto; min-width: 140px; margin: 5px 0 0 0; border-color: #4f7cff; }

.page { width: 100%; animation: fadeIn 0.3s ease-in; }
@keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
</style>
</head>
<body>

<header>หาเซิร์ฟเกม</header>

<div class="container">

  <div id="page1" class="page">
    <h2 style="text-align:center; margin-bottom:30px;">เลือกเกมที่ต้องการ</h2>
    <div class="grid">
      <div class="card">
        <img src="Minecraft_F.png" alt="Minecraft">
        <h3 style="margin-top:10px;">Minecraft</h3>
        <button class="card-btn" onclick="chooseGame('Minecraft')">เลือก</button>
      </div>
      <div class="card">
        <img src="Roblox_F.png" alt="Roblox">
        <h3 style="margin-top:10px;">Roblox</h3>
        <button class="card-btn" onclick="chooseGame('Roblox')">เลือก</button>
      </div>
    </div>
  </div>

  <div id="page2" class="page hidden">
    <button class="back" onclick="goPage(1)">← ย้อนกลับ</button>
    <h2 id="gameTitle" style="text-align:center; margin-bottom:30px;"></h2>
    <div class="grid" id="modeList"></div>
  </div>

  <div id="page3" class="page hidden">
    <button class="back" onclick="goPage(2)">← ย้อนกลับ</button>
    <h2 id="serverTitle" style="text-align:center; margin-bottom:10px;"></h2>
    
    <div id="filterContainer" class="filter-box">
      <label>เวอร์ชัน:<br>
        <select id="filterVersion" onchange="renderServers()">
          <option value="">ทั้งหมด</option>
          <option value="original">แท้</option>
          <option value="both">แท้/เถื่อน</option>
        </select>
      </label>
      <label>Edition:<br>
        <select id="filterEdition" onchange="renderServers()">
          <option value="">ทั้งหมด</option>
          <option value="java">Java</option>
          <option value="bedrock">Bedrock</option>
          <option value="both">ทั้งสอง</option>
        </select>
      </label>
    </div>

    <div class="grid" id="serverList"></div>
  </div>

  <div id="page4" class="page hidden">
    <button class="back" onclick="goPage(3)">← ย้อนกลับ</button>
    <div style="max-width:700px; width:100%; margin:auto;">
      <h2 id="detailName" style="text-align:center; margin-bottom:20px;"></h2>
      <div class="card" style="cursor:default;">
        <img id="detailImgTag" src="" style="height:auto; max-height:400px;">
        <div id="detailExtra" style="text-align:left; margin: 15px 0; background:#0b0b0f; padding:20px; border-radius:15px; border:1px solid #333;"></div>
        <p id="detailDesc" style="color:#aaa; line-height:1.6; margin-bottom:20px; text-align:left; white-space: pre-line;"></p>
        <button class="delete-btn" id="deleteBtn">ลบเซิฟเวอร์นี้ออกจากระบบ</button>
      </div>
    </div>
  </div>

  <div id="addPage" class="page hidden">
    <button class="back" onclick="goPage(1)">← ย้อนกลับ</button>
    <h2 style="text-align:center; margin-bottom:25px;">ลงประกาศเซิร์ฟเวอร์</h2>
    <div style="max-width: 500px; width:100%; margin:auto; background:#14141c; padding:25px; border-radius:20px; border: 1px solid #2a2a38;">
      <select id="addGame" onchange="updateAddModes();toggleAdd()">
        <option value="">-- เลือกเกม --</option>
        <option>Minecraft</option>
        <option>Roblox</option>
      </select>
      <input id="addName" placeholder="ชื่อเซิร์ฟเวอร์">
      <textarea id="addDesc" rows="4" placeholder="รายละเอียด/ช่องทางติดต่อ"></textarea>

      <div style="background:#1b1b26; padding:15px; border-radius:12px; margin-bottom:15px;">
        <b style="display:block; margin-bottom:10px;">เลือกแนวเกม (เลือกได้อย่างน้อย 1)</b>
        <div id="addModeList"></div>
      </div>

      <div id="mcExtra" class="hidden">
        <select id="mcVersion"><option value="original">แท้เท่านั้น</option><option value="both">แท้/เถื่อน</option></select>
        <select id="mcEdition"><option value="java">Java</option><option value="bedrock">Bedrock</option><option value="both">ทั้งสอง</option></select>
        <input id="mcRealVersion" placeholder="เวอร์ชัน (เช่น 1.20.1)">
        <input id="pcIP" placeholder="PC IP">
        <input id="phoneIP" placeholder="Phone IP (ถ้ามี)">
      </div>

      <div id="rbxFields" class="hidden">
        <input id="rbxLink" placeholder="ลิงก์ Roblox (https://...)">
      </div>

      <b>รูปภาพหน้าปก</b>
      <input type="file" accept="image/*" id="addImg" style="margin-top:10px;">
      <div id="imgPreview" style="margin-top:10px; text-align:center;"></div>
      
      <button onclick="saveServer()" style="margin-top:20px; background:#27ae60; color:white; border:none; padding:15px; width:100%; border-radius:10px; font-weight:bold; cursor:pointer;">บันทึกข้อมูลและลงประกาศ</button>
    </div>
  </div>

</div>

<button class="add-btn" onclick="openAdd()">＋</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBcs3Owrnp3doAgLpT84ieIZZ-RL8XA8zs",
  authDomain: "gamesevers-5421f.firebaseapp.com",
  databaseURL: "https://gamesevers-5421f-default-rtdb.firebaseio.com",
  projectId: "gamesevers-5421f"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* Elements */
const gameTitle=document.getElementById("gameTitle"), serverTitle=document.getElementById("serverTitle"),
      modeList=document.getElementById("modeList"), serverList=document.getElementById("serverList"),
      detailName=document.getElementById("detailName"), detailDesc=document.getElementById("detailDesc"),
      detailExtra=document.getElementById("detailExtra"), detailImgTag=document.getElementById("detailImgTag"),
      addGame=document.getElementById("addGame"), addName=document.getElementById("addName"),
      addDesc=document.getElementById("addDesc"), addModeList=document.getElementById("addModeList"),
      rbxFields=document.getElementById("rbxFields"), pcIP=document.getElementById("pcIP"),
      phoneIP=document.getElementById("phoneIP"), rbxLink=document.getElementById("rbxLink"),
      addImg=document.getElementById("addImg"), imgPreview=document.getElementById("imgPreview"),
      mcExtra=document.getElementById("mcExtra"), mcVersion=document.getElementById("mcVersion"),
      mcEdition=document.getElementById("mcEdition"), mcRealVersion=document.getElementById("mcRealVersion"),
      deleteBtn=document.getElementById("deleteBtn"), filterContainer=document.getElementById("filterContainer"),
      filterVersion=document.getElementById("filterVersion"), filterEdition=document.getElementById("filterEdition");

let servers=[];
let currentGame="", currentMode="", currentServerId="", base64Img="";

const modesByGame={
  Minecraft:["Survival","RPG","PVP","Skyblock","Minigame"],
  Roblox:["Adventure","RPG","Simulator","Obby","PVP","Tower Defense"]
};

/* Navigation Logic */
window.show=(p)=>{
    document.querySelectorAll('.page').forEach(d=>d.classList.add('hidden'));
    document.getElementById(p).classList.remove('hidden');
    window.scrollTo(0,0);
};
window.goPage=n=>show("page"+n);
window.openAdd=()=>show("addPage");

window.chooseGame=g=>{
  currentGame=g;
  gameTitle.innerText="หมวดหมู่: " + g;
  modeList.innerHTML="";
  modesByGame[g].forEach(m=>{
    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `<h3>${m}</h3><button class="card-btn" onclick="chooseMode('${m}')">เลือกแนวนนี้</button>`;
    modeList.appendChild(d);
  });
  show("page2");
};

window.chooseMode=m=>{
  currentMode=m;
  serverTitle.innerText=currentGame + " » " + m;
  filterContainer.style.display = (currentGame === "Minecraft") ? "flex" : "none";
  renderServers();
  show("page3");
};

/* Render List Logic */
window.renderServers = () => {
  serverList.innerHTML="";
  let filtered = servers.filter(s=>s.game===currentGame && Array.isArray(s.modes) && s.modes.includes(currentMode));
  
  if(currentGame==="Minecraft"){
    if(filterVersion.value) filtered = filtered.filter(s=>s.version===filterVersion.value);
    if(filterEdition.value) filtered = filtered.filter(s=>s.edition===filterEdition.value);
  }

  if(filtered.length === 0) {
    serverList.innerHTML = "<div style='grid-column: 1/-1; text-align:center; padding:100px 0; color:#555;'>ยังไม่มีการประกาศในขณะนี้</div>";
    return;
  }

  filtered.forEach(s=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
        <img src="${s.img}">
        <h3>${s.name}</h3>
        <button class="card-btn" onclick="openDetail('${s.id}')">ดูรายละเอียด</button>
    `;
    serverList.appendChild(card);
  });
};

window.openDetail=id=>{
  const s=servers.find(x=>x.id===id);
  if(!s) return;
  currentServerId=id;
  detailName.innerText=s.name;
  detailDesc.innerText=s.desc;
  detailImgTag.src=s.img;
  
  if(s.game==="Minecraft") {
    detailExtra.innerHTML = `
      <p><b>Version:</b> ${s.realVersion||"-"}</p>
      <p><b>ระบบ:</b> ${s.version==="original"?"แท้เท่านั้น":"แท้/เถื่อน"}</p>
      <p><b>Edition:</b> ${s.edition ? s.edition.toUpperCase() : "-"}</p>
      <hr style="margin:15px 0; border:0; border-top:1px solid #333;">
      <p><b>IP (PC):</b> <span style="color:#4f7cff">${s.pc||"-"}</span></p>
      <p><b>IP (Phone):</b> <span style="color:#4f7cff">${s.phone||"-"}</span></p>
    `;
  } else {
    detailExtra.innerHTML = `<a href="${s.link}" target="_blank" style="text-decoration:none;"><button class="card-btn" style="background:#00c2ff;">เข้าเล่นผ่าน Roblox</button></a>`;
  }
  show("page4");
};

deleteBtn.onclick = () => {
  if(confirm("ยืนยันการลบข้อมูลนี้ออกจากระบบ?")){
    remove(ref(db,"servers/"+currentServerId)).then(()=>{
      alert("ลบข้อมูลเรียบร้อย");
      show("page1");
    });
  }
};

/* Form & Data Logic */
window.toggleAdd=()=>{
  mcExtra.classList.toggle("hidden", addGame.value!=="Minecraft");
  rbxFields.classList.toggle("hidden", addGame.value!=="Roblox");
};

window.updateAddModes=()=>{
  addModeList.innerHTML="";
  if(!addGame.value) return;
  modesByGame[addGame.value].forEach(m=>{
    const l = document.createElement('label');
    l.style.display = "block";
    l.style.margin = "8px 0";
    l.style.cursor = "pointer";
    l.innerHTML = `<input type="checkbox" value="${m}" style="width:auto; margin-right:10px;"> ${m}`;
    addModeList.appendChild(l);
  });
};

addImg.onchange=()=>{
  const f=addImg.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=e=>{
    base64Img = e.target.result;
    imgPreview.innerHTML=`<img src="${base64Img}" style="width:100%; border-radius:10px; margin-top:10px; border: 1px solid #333;">`;
  };
  r.readAsDataURL(f);
};

window.saveServer=()=>{
  const modes=[...addModeList.querySelectorAll("input:checked")].map(c=>c.value);
  if(!addGame.value||!addName.value||modes.length===0||!base64Img) return alert("กรุณากรอกข้อมูลและอัปโหลดรูปภาพให้ครบถ้วน");

  const serverData = {
    game:addGame.value, name:addName.value, desc:addDesc.value, modes:modes, img:base64Img,
    pc:pcIP.value||null, phone:phoneIP.value||null, link:rbxLink.value||null,
    version:addGame.value==="Minecraft"?mcVersion.value:null,
    edition:addGame.value==="Minecraft"?mcEdition.value:null,
    realVersion:addGame.value==="Minecraft"?mcRealVersion.value:null
  };

  push(ref(db,"servers"), serverData).then(()=>{
    alert("ลงประกาศสำเร็จแล้ว!");
    location.reload();
  });
};

/* Firebase Sync */
onValue(ref(db,"servers"), snap=>{
  servers=[];
  snap.forEach(c=>servers.push({id:c.key,...c.val()}));
  if(!document.getElementById("page3").classList.contains("hidden")) renderServers();
});
</script>
</body>
</html>
