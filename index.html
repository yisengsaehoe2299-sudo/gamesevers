<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Game Server Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* 1. พื้นฐาน: ป้องกันการทับกันด้วยการจัดการ Box Model */
*{box-sizing:border-box; margin:0; padding:0; font-family: sans-serif;}
body{background:#0b0b0f; color:#fff; min-height:100vh; line-height: 1.5;}

header{padding:25px; text-align:center; font-size:28px; font-weight:bold; background:#14141c;}

/* 2. Container: ยืดหยุ่นตามเนื้อหา ไม่ล็อคความสูง */
.container{
  max-width:1200px;
  margin:0 auto;
  padding:20px;
  width: 100%;
}

/* 3. Grid: หัวใจสำคัญที่ทำให้ไม่ซ้อนกัน */
.grid{
  display: grid;
  /* บังคับสร้างคอลัมน์ ขนาดขั้นต่ำ 250px ถ้าจอแคบจะลงแถวใหม่เอง */
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
  gap: 20px; /* เว้นระยะห่างระหว่างการ์ด */
  width: 100%;
  align-items: stretch; /* ให้การ์ดสูงเท่ากันในแถว */
}

/* 4. Card: ตั้งค่าเป็น Block ปกติเพื่อให้มันผลักกัน */
.card{
  background:#1b1b26;
  border-radius:15px;
  padding:20px;
  display: flex;
  flex-direction: column;
  border: 1px solid #333;
  transition: 0.3s;
}
.card:hover{ border-color: #4f7cff; transform: translateY(-5px); }

.card img{
  width:100%;
  height:160px;
  object-fit:cover;
  border-radius:10px;
  margin-bottom:15px;
}

/* UI อื่นๆ */
button{
  width:100%; padding:12px; border:none; border-radius:10px;
  background:#4f7cff; color:#fff; cursor:pointer; font-weight:bold;
}
button:hover{ background:#0353e9; }

.back{ background:#444; width:auto; padding:8px 25px; margin-bottom:20px; }
.delete-btn{ background:#e63946; margin-top:10px; }

.add-btn{
  position:fixed; bottom:30px; right:30px; width:60px; height:60px;
  border-radius:50%; background:#ff4f8b; color:#fff; border:none;
  cursor:pointer; z-index:100; font-size:30px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

.filter-box{
  background:#14141c; padding:20px; border-radius:12px;
  margin-bottom:20px; display:none; gap:15px; flex-wrap:wrap; justify-content:center;
}

.hidden{ display:none !important; }

input, select, textarea {
  width:100%; padding:12px; margin-bottom:12px; border-radius:8px;
  border:1px solid #333; background:#0b0b0f; color:#fff;
}
</style>
</head>
<body>

<header>หาเซิร์ฟเกม</header>

<div class="container">

  <div id="page1" class="page">
    <h2 style="text-align:center; margin-bottom:20px;">เลือกเกม</h2>
    <div class="grid">
      <div class="card">
        <img src="Minecraft_F.png" alt="Minecraft">
        <button onclick="chooseGame('Minecraft')">Minecraft</button>
      </div>
      <div class="card">
        <img src="Roblox_F.png" alt="Roblox">
        <button onclick="chooseGame('Roblox')">Roblox</button>
      </div>
    </div>
  </div>

  <div id="page2" class="page hidden">
    <button class="back" onclick="goPage(1)">← กลับ</button>
    <h2 id="gameTitle" style="text-align:center; margin-bottom:20px;"></h2>
    <div class="grid" id="modeList"></div>
  </div>

  <div id="page3" class="page hidden">
    <button class="back" onclick="goPage(2)">← กลับ</button>
    <h2 id="serverTitle" style="text-align:center; margin-bottom:10px;"></h2>
    
    <div id="filterContainer" class="filter-box">
      <label>เวอร์ชัน: <select id="filterVersion" onchange="renderServers()">
        <option value="">ทั้งหมด</option><option value="original">แท้</option><option value="both">แท้/เถื่อน</option>
      </select></label>
      <label>Edition: <select id="filterEdition" onchange="renderServers()">
        <option value="">ทั้งหมด</option><option value="java">Java</option><option value="bedrock">Bedrock</option>
      </select></label>
    </div>

    <div class="grid" id="serverList"></div>
  </div>

  <div id="page4" class="page hidden">
    <button class="back" onclick="goPage(3)">← กลับ</button>
    <div style="max-width:500px; margin:auto;">
      <div class="card">
        <h2 id="detailName" style="margin-bottom:15px;"></h2>
        <img id="detailImg" src="">
        <div id="detailExtra" style="background:#0b0b0f; padding:15px; border-radius:10px; margin-bottom:15px;"></div>
        <p id="detailDesc" style="color:#ccc; margin-bottom:20px;"></p>
        <button class="delete-btn" id="deleteBtn">ลบเซิร์ฟนี้</button>
      </div>
    </div>
  </div>

  <div id="addPage" class="page hidden">
    <button class="back" onclick="goPage(1)">← กลับ</button>
    <div style="max-width:500px; margin:auto; background:#1b1b26; padding:25px; border-radius:15px;">
      <h2>เพิ่มเซิร์ฟเวอร์</h2><br>
      <select id="addGame" onchange="updateAddModes();toggleAdd()">
        <option value="">-- เลือกเกม --</option><option>Minecraft</option><option>Roblox</option>
      </select>
      <input id="addName" placeholder="ชื่อเซิร์ฟ">
      <textarea id="addDesc" placeholder="รายละเอียด"></textarea>
      <div id="addModeList" style="margin-bottom:15px; background:#0b0b0f; padding:10px; border-radius:8px;"></div>
      
      <div id="mcExtra" class="hidden">
        <select id="mcVersion"><option value="original">แท้</option><option value="both">แท้/เถื่อน</option></select>
        <select id="mcEdition"><option value="java">Java</option><option value="bedrock">Bedrock</option></select>
        <input id="mcRealVersion" placeholder="เวอร์ชัน เช่น 1.20">
        <input id="pcIP" placeholder="PC IP">
        <input id="phoneIP" placeholder="Phone IP">
      </div>
      <div id="rbxFields" class="hidden"><input id="rbxLink" placeholder="ลิงก์ Roblox"></div>
      
      <b>รูปปก:</b><input type="file" id="addImg" accept="image/*" style="margin-top:10px;">
      <div id="imgPreview" style="margin-top:10px;"></div>
      <button onclick="saveServer()" style="margin-top:20px; background:#27ae60;">ลงประกาศ</button>
    </div>
  </div>

</div>

<button class="add-btn" onclick="openAdd()">＋</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBcs3Owrnp3doAgLpT84ieIZZ-RL8XA8zs",
  authDomain: "gamesevers-5421f.firebaseapp.com",
  databaseURL: "https://gamesevers-5421f-default-rtdb.firebaseio.com",
  projectId: "gamesevers-5421f"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const els = {
  page1: document.getElementById("page1"), gameTitle: document.getElementById("gameTitle"),
  modeList: document.getElementById("modeList"), serverList: document.getElementById("serverList"),
  serverTitle: document.getElementById("serverTitle"), filterContainer: document.getElementById("filterContainer"),
  detailName: document.getElementById("detailName"), detailImg: document.getElementById("detailImg"),
  detailDesc: document.getElementById("detailDesc"), detailExtra: document.getElementById("detailExtra"),
  addGame: document.getElementById("addGame"), addModeList: document.getElementById("addModeList"),
  imgPreview: document.getElementById("imgPreview"), mcExtra: document.getElementById("mcExtra"),
  rbxFields: document.getElementById("rbxFields"), addImg: document.getElementById("addImg")
};

let servers = [], currentGame = "", currentMode = "", currentId = "", base64 = "";
const modes = { Minecraft: ["Survival", "RPG", "PVP", "Skyblock"], Roblox: ["Adventure", "RPG", "Simulator", "Obby"] };

window.show = p => {
  document.querySelectorAll('.page').forEach(d => d.classList.add('hidden'));
  document.getElementById(p).classList.remove('hidden');
  window.scrollTo(0,0);
};
window.goPage = n => show("page" + n);
window.openAdd = () => show("addPage");

window.chooseGame = g => {
  currentGame = g; els.gameTitle.innerText = g; els.modeList.innerHTML = "";
  modes[g].forEach(m => {
    const card = document.createElement("div"); card.className = "card";
    card.innerHTML = `<button onclick="chooseMode('${m}')">${m}</button>`;
    els.modeList.appendChild(card);
  });
  show("page2");
};

window.chooseMode = m => {
  currentMode = m; els.serverTitle.innerText = currentGame + " : " + m;
  els.filterContainer.style.display = (currentGame === "Minecraft") ? "flex" : "none";
  renderServers(); show("page3");
};

window.renderServers = () => {
  els.serverList.innerHTML = "";
  let list = servers.filter(s => s.game === currentGame && s.modes && s.modes.includes(currentMode));
  
  if(currentGame === "Minecraft") {
    const v = document.getElementById("filterVersion").value, e = document.getElementById("filterEdition").value;
    if(v) list = list.filter(s => s.version === v);
    if(e) list = list.filter(s => s.edition === e);
  }

  if(list.length === 0) { els.serverList.innerHTML = "<p>ไม่พบเซิร์ฟเวอร์</p>"; return; }

  list.forEach(s => {
    const card = document.createElement("div"); card.className = "card";
    card.innerHTML = `<img src="${s.img}"><h3>${s.name}</h3><br><button onclick="openDetail('${s.id}')">ดูรายละเอียด</button>`;
    els.serverList.appendChild(card);
  });
};

window.openDetail = id => {
  const s = servers.find(x => x.id === id); if(!s) return;
  currentId = id; els.detailName.innerText = s.name; els.detailImg.src = s.img; els.detailDesc.innerText = s.desc;
  els.detailExtra.innerHTML = s.game === "Minecraft" ? `<p>IP PC: ${s.pc||"-"}</p><p>IP Phone: ${s.phone||"-"}</p><p>Ver: ${s.realVersion||"-"}</p>` : `<a href="${s.link}" target="_blank"><button>ไปที่ Roblox</button></a>`;
  show("page4");
};

document.getElementById("deleteBtn").onclick = () => {
  if(confirm("ลบใช่ไหม?")) { remove(ref(db, "servers/" + currentId)); show("page1"); }
};

window.toggleAdd = () => {
  els.mcExtra.classList.toggle("hidden", els.addGame.value !== "Minecraft");
  els.rbxFields.classList.toggle("hidden", els.addGame.value !== "Roblox");
};

window.updateAddModes = () => {
  els.addModeList.innerHTML = ""; if(!els.addGame.value) return;
  modes[els.addGame.value].forEach(m => {
    els.addModeList.innerHTML += `<label><input type="checkbox" value="${m}"> ${m}</label><br>`;
  });
};

els.addImg.onchange = e => {
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => {
    base64 = ev.target.result;
    els.imgPreview.innerHTML = `<img src="${base64}" style="width:100px; border-radius:5px;">`;
  }; r.readAsDataURL(f);
};

window.saveServer = () => {
  const mds = [...els.addModeList.querySelectorAll("input:checked")].map(i => i.value);
  if(!els.addGame.value || !base64 || mds.length === 0) return alert("กรอกข้อมูลให้ครบ");
  const data = {
    game: els.addGame.value, name: document.getElementById("addName").value, desc: document.getElementById("addDesc").value,
    modes: mds, img: base64, link: document.getElementById("rbxLink").value, pc: document.getElementById("pcIP").value,
    phone: document.getElementById("phoneIP").value, version: document.getElementById("mcVersion").value,
    edition: document.getElementById("mcEdition").value, realVersion: document.getElementById("mcRealVersion").value
  };
  push(ref(db, "servers"), data).then(() => { alert("สำเร็จ"); location.reload(); });
};

onValue(ref(db, "servers"), snap => {
  servers = []; snap.forEach(c => servers.push({ id: c.key, ...c.val() }));
  if(!els.page1.classList.contains("hidden")) return; renderServers();
});
</script>
</body>
</html>
